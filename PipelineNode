node {
    checkout scm    
    stage ('Build') {
        withMaven ( maven: 'Maven Test') {
                   sh 'mvn compile'
                   }
    }   
    stage ('Test') {
        withMaven ( maven: 'Maven Test') {
            sh 'mvn test'
                   }
    }
    stage ('Deploy') {
        try {
            withMaven ( maven: 'Maven Test') {
                sh 'mvn package'
                fileOperations([fileCreateOperation(folderpath: '/home/ivan/artefactos/pipeline')])
                fileOperations([fileCopyOperation(excludes: '', flattenFiles: false, includes: '**/*.jar*', targetLocation: '/home/ivan/artefactos/pipeline')])
                    }
        }finally {
          deleteDir()
        }
    }
}
